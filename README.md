# MTMR
Multi-reader, Multi-test Analysis Tool

为便于实际应用, 我给出了mtmr\_app.R的分析工具, 支持根据已有数据作假设检验和给出最优样本分配方案两个主要功能。还提供了功效计算和相关系数估计两个附带功能。在完成假设检验后,如果希望得到指定的AUC差值的功效, 可以使用函数mtmr\_power()来计算功效; 如果在样本量预估时不确定相关系数, 可以先使用相关领域的已有数据来得到相关系数作为输入, 然后再完成样本量的预估。

对于输入数据, 要按照以下格式。设有m个恶性病人, n个良性病人, r个医生, h种医疗影像(一般设为2)。那么需要两个打分矩阵$\textbf{X}_{(m+n)\times rh}$和$\textbf{Y}_{(m+n)\times rh}$作为输入。$\textbf{X}$对应恶性病人的得分矩阵, 第i行即为第i个病人的所有得分, 其中第$(l-1)r+1$至第$lr$列依次为r名医生使用第l种方法的打分。$\textbf{Y}$对应恶性病人的得分矩阵, 含义同上。

下面对这几个功能对应的函数给出详细说明。
\begin{itemize}
	\item mtmr\_test():\textbf{完成假设检验的函数, 输入参数为}\\
	x\_rate: 恶性病人的得分矩阵(必须给出)\\
	y\_rate: 良性病人的得分矩阵(必须给出)\\
	level: 置信度, 默认值为0.95\\
	times: 如果选用bootstrap, 随机模拟的次数(默认为20000, 建议不要再大, 否则运行较慢)\\
	h: 医疗影像的种类数(一般设置为2)\\
	fixed\_reader: bool值(默认为TRUE)。TRUE表示认为医生是固定的, 否则认为医生是随机选取的。\\
	\textbf{输出结果为一个list:}\\
	第一项为检验结论(那个影像方法更好), 第二项为AUC差值的区间估计, 第三项为第一种影像方法辅助下的AUC的区间估计, 第四项为第二种影像方法辅助下的AUC的区间估计。
	\\
	\item mtmr\_power(): \textbf{完成功效估计的函数, 输入参数为}\\
	r: 医生数量(必须给出)\\
	m: 恶性病例数量(必须给出)\\
	n: 良性病例数量(必须给出)\\
	AUC: 不同影像方法辅助下的AUC均值(必须给出)\\
	delta: 认为两种影像有区别时的AUC差值的阈值(必须给出)\\
	level: 置信度(默认为0.95)\\
	rho\_exp: 参照第三章中的定义的相关系数,即$\boldsymbol{\rho} = (\rho_{11}, \rho_{12}, \rho_{13},\rho_{14},\rho_{21},\rho_{22},\\
	\rho_{23},\rho_{24},1, \rho_{32},\rho_{33},\rho_{34})$。在计算功效时必须给出。\\
	equal\_p: 默认为0。如果打分是离散值,需要设置为恶性患者与良性患者被同一名医生在相同影像辅助下打分相同的概率\\
	\textbf{输出结果为检验功效的估计值}
	\\
	\item mtmr\_correlation():\textbf{得到相关系数的函数,输入为参数}\\
	x\_rate: 恶性病人的得分矩阵(必须给出)\\
	y\_rate: 良性病人的得分矩阵(必须给出)\\
	h: 医疗影像的种类数(默认为2)\\
	\textbf{输出结果为长度为13的向量,前12项用于计算mtmr\_power()函数中用到的参数rho\_exp, 第13项用于计算mtmr\_power()函数中的参数equal\_p}
	\\
	\item mtmr\_samplesize():\textbf{计算最优样本分配的函数, 输入参数为}\\
	r: 医生数量(必须给出)\\
	AUC: 不同影像方法辅助下的AUC均值(必须给出)\\
	delta: 认为两种影像有区别时的AUC差值的阈值(必须给出)\\ 
	power: 希望达到的检验功效(必须给出)\\
	rho\_exp: 参照第三章中的定义的相关系数,即$\boldsymbol{\rho} = (\rho_{11}, \rho_{12}, \rho_{13},\rho_{14},\rho_{21},\rho_{22},\\
	\rho_{23},\rho_{24},1, \rho_{32},\rho_{33},\rho_{34})$。(必须给出)\\
	equal\_p: 默认为0。如果打分是离散值,需要设置为恶性患者与良性患者被同一名医生在相同影像辅助下打分相同的概率\\
	ratio: 默认为best, 表示采用使总病例数最少的方案。 也可以强制指定一个0至1之间的小数, 表示恶性患者的占比。
	level: 置信度要求(默认为0.95)\\
	\textbf{输出为长度为3的向量, 表示对应要求下的最优分配结果。依次为所需的总病例数, 恶性病例数和良性病例数。}\\	
\end{itemize}
